!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("swap-sw"),require("swap-sw/node"),require("swap-jsbridge"),require("axios")):"function"==typeof define&&define.amd?define(["exports","swap-sw","swap-sw/node","swap-jsbridge","axios"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).swapSW={},e["swap-sw"],e["swap-sw"],e["swap-jsbridge"],e.axios)}(this,(function(e,t,n,r,o){"use strict";function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=s(o),i={mode:"MOCK",isMock:!1,bypassMode:"none",mockData:{},unmatchedMock:{code:999,msg:"没有匹配到数据"},swapJestServer:{},workerOpt:null,isOnline:!1,baseURL:""},u=function(e){return e?i[e]:i},c=function(e,t){return i[e]=t,i},l=function(e){return Object.entries(e).forEach((function(e){var t=e[0],n=e[1];c(t,n)})),i},f=function(){return f=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},f.apply(this,arguments)};function p(e,t,n,r){return new(n||(n=Promise))((function(o,s){function a(e){try{u(r.next(e))}catch(e){s(e)}}function i(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}u((r=r.apply(e,t||[])).next())}))}function d(e,t){var n,r,o,s,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}}function w(e,t,n){if(n||2===arguments.length)for(var r,o=0,s=t.length;o<s;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}var h=function(e){var n=[];return Object.entries(e).forEach((function(e){var r=e[0],o=e[1],s=v(r),a=s.method,i=s.url;t.rest[a]?"function"==typeof o?n.push(t.rest[a](i,o)):n.push(t.rest[a](i,(function(e,t,n){return t(n.status(200),n.json(o))}))):console.error("".concat(r,"无效字段"))})),n},v=function(e){var t=e.split(" "),n=t[0],r=t[1];return{method:n.toLowerCase(),url:r}},b=function(){t.setupWorker().stop()},y=b,m=function(e,t,n){return p(this,void 0,void 0,(function(){return d(this,(function(r){switch(r.label){case 0:return[4,a.default.create({baseURL:e,timeout:2e4,withCredentials:!1,headers:{"x-swap-jsbridge":"true"}}).get(t,{params:n})];case 1:return[2,r.sent().data]}}))}))};var k=function(e,t){return p(this,void 0,void 0,(function(){var n,r,o;return d(this,(function(s){switch(s.label){case 0:return n=e.split("://"),r=n[0],o=n[1],[4,m(r,"/".concat(o),t)];case 1:return[2,s.sent()]}}))}))},g=function(e){return function(t,n){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];return p(this,void 0,void 0,(function(){var o,s,a;return d(this,(function(i){switch(i.label){case 0:return o=u(),s=o.isMock,a=o.bypassMode,s&&["api","none"].includes(a)?[4,k(t,n).catch((function(){return{}}))]:[3,2];case 1:return[2,i.sent()];case 2:return[2,e.call.apply(e,w([this,t,n],r,!1))]}}))}))}},S=g(r.call),x=g(r.callWithPromise),M="function"==typeof setImmediate?setImmediate:setTimeout,j=function(){t.setupWorker().restoreHandlers()},O=function(){t.setupWorker().resetHandlers()};e.getSwapJestServer=function(){return u("swapJestServer")},e.swapCall=S,e.swapCallWithPromise=x,e.swapInit=function(e){if(l(f({isMock:!0},e)),u("isMock"))return function(){if("JEST"!==u("mode")){var e=h(u("mockData")),n=t.setupWorker.apply(void 0,e),r=u(),o=r.workerOpt,s=r.bypassMode,a=r.isOnline,i=r.baseURL;n.start(f({bypassMode:s,isOnline:a,baseURL:i},o))}}();b()},e.swapJestInit=function(e){var t=e.isMock,r=void 0===t||t,o=e.mockData;process.env.isJest="true",l({mockData:o,isMock:r,mode:"JEST"});var s=h(u("mockData")),a=n.setupServer.apply(void 0,s);return c("swapJestServer",a),a},e.swapJestListen=function(){var e=u("swapJestServer");e.listen&&e.resetHandlers&&e.close&&(beforeAll((function(){return e.listen()})),afterEach((function(){return e.resetHandlers()})),afterAll((function(){return e.close()})))},e.swapResetHandlers=O,e.swapRestoreHandlers=j,e.swapStop=y,e.waitFor=function(){return new Promise((function(e){M(e)}))}}));

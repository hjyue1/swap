!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@swap/sw"),require("@swap/sw/node"),require("@swap/jsbridge"),require("axios")):"function"==typeof define&&define.amd?define(["exports","@swap/sw","@swap/sw/node","@swap/jsbridge","axios"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).swapSW={},e["@swap/sw"],e["@swap/sw"],e["@swap/jsbridge"],e.axios)}(this,(function(e,t,s,n,o){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=r(o);const a={mode:"MOCK",isMock:!1,bypassMode:"none",mockData:{},unmatchedMock:{code:999,msg:"没有匹配到数据"},swapJestServer:{},workerOpt:null,isOnline:!1,baseURL:""},c=function(e){return e?a[e]:a},u=function(e,t){return a[e]=t,a},f=function(e){return Object.entries(e).forEach((([e,t])=>{u(e,t)})),a},p=function(e){const s=[];return Object.entries(e).forEach((([e,n])=>{const{method:o,url:r}=d(e);t.rest[o]?"function"==typeof n?s.push(t.rest[o](r,n)):s.push(t.rest[o](r,((e,t,s)=>t(s.status(200),s.json(n))))):console.error(`${e}无效字段`)})),s},d=function(e){const[t,s]=e.split(" ");return{method:t.toLowerCase(),url:s}},l=function(){t.setupWorker().stop()},w=l;function m(e,t,s,n){return new(s||(s=Promise))((function(o,r){function i(e){try{c(n.next(e))}catch(e){r(e)}}function a(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,a)}c((n=n.apply(e,t||[])).next())}))}const h=function(e,t){return m(this,void 0,void 0,(function*(){const[s,n]=e.split("://");return yield function(e,t,s){return m(this,void 0,void 0,(function*(){const n=i.default.create({baseURL:e,timeout:2e4,withCredentials:!1,headers:{"x-swap-jsbridge":"true"}});return(yield n.get(t,{params:s})).data}))}(s,`/${n}`,t)}))},b=function(e){return function(t,s,...n){return m(this,void 0,void 0,(function*(){const{isMock:o,bypassMode:r}=c();return o&&["api","none"].includes(r)?yield h(t,s).catch((()=>({}))):e.call(this,t,s,...n)}))}},k=b(n.call),v=b(n.callWithPromise),y="function"==typeof setImmediate?setImmediate:setTimeout,M=function(){t.setupWorker().restoreHandlers()},g=function(){t.setupWorker().resetHandlers()};e.getSwapJestServer=function(){return c("swapJestServer")},e.swapCall=k,e.swapCallWithPromise=v,e.swapInit=e=>{if(f(Object.assign({isMock:!0},e)),c("isMock"))return function(){if("JEST"===c("mode"))return;const e=p(c("mockData")),s=t.setupWorker(...e),{workerOpt:n,bypassMode:o,isOnline:r,baseURL:i}=c();s.start(Object.assign({bypassMode:o,isOnline:r,baseURL:i},n))}();l()},e.swapJestInit=function({isMock:e=!0,mockData:t}){process.env.isJest="true",f({mockData:t,isMock:e,mode:"JEST"});const n=p(c("mockData")),o=s.setupServer(...n);return u("swapJestServer",o),o},e.swapJestListen=function(){const e=c("swapJestServer");e.listen&&e.resetHandlers&&e.close&&(beforeAll((()=>e.listen())),afterEach((()=>e.resetHandlers())),afterAll((()=>e.close())))},e.swapResetHandlers=g,e.swapRestoreHandlers=M,e.swapStop=w,e.waitFor=function(){return new Promise((e=>{y(e)}))}}));
